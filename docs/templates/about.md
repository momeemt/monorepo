# 1.1 - テンプレートの概要

## 1.1.1 - 衛生性
デフォルトでは、**type**(型定義)、**var**(変数定義)、**let**(定数定義)、**const**(コンパイル時定数定義)は独自のスコープを持ちます。これを**gensym**であると言います。  

また、**proc**(プロシージャ定義)、**iterator**(イテレータ定義)、**converter**(コンバータ定義)、**template**(テンプレート定義)、**macro**(マクロ定義)はスコープを持たず、置換されて生成されたNimNodeはテンプレート外からアクセスできます。これを**inject**であると言います。  

```nim
template myTemplate (name, value: untyped): untyped =
  let name {.inject.} = value
```

第3章で詳しく解説する**プラグマ**という機能を用いて、injectとgensymを個別に与えることができます。  

このようにテンプレート内のスコープを管理することで**衛生性**を保っています。

## 1.1.2 - 遅延評価性
渡したパラメータはテンプレートが実体化されるまで遅延されるので、テンプレートは**遅延評価**を行います。  

## 1.1.3 - 型
テンプレート、マクロには**typed**、**untyped**という特殊な型を渡すことができます。  

**untyped**型は、型が決定していないことを表す型です。untyped型を引数に渡すと、そのシンボルを評価する前にテンプレート、ないしはマクロに渡されます。これは、**コンパイル時点では与えられるNimNodeにコンパイラが関与する必要がない**とコンパイラに告げることになります。ただし、生成されるコードがコンパイラにチェックされ、不正なASTを持つNimNodeは弾くことができます。  

**typed**型は、テンプレートやマクロにシンボルが渡る前にコンパイラがそのシンボルを評価する型です。ただし、渡される値はNimNodeによる構文木です。シンボルが評価されるので、**NimNodeが型情報を持つ**特徴があります。typed以外にも、**int**や**string**など、具体的な型を明示できますが、いずれにせよNimNodeによる構文木が渡されるので注意しなければいけません。  

**static**型、つまり**静的引数**は、テンプレートやマクロにNimNodeによる構文木ではなく、**値を値として渡す**ことができます。  

また、たびたび登場している**NimNode**ですが、抽象構文木のノード型であり、NimNode型を用いてNim言語で表現できる全てのプログラムを構築することができます。また、NimNodeの種類を示す**NimNodeKind**型も存在し、実際に抽象構文木を操作してマクロを構築していく場合には仲良くなるべき型でしょう。

## 1.1.4 - NimNodeをチェックする